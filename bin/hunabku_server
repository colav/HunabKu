#!/usr/bin/env python3

from hunabku.Hunabku import Hunabku
import socket
import argparse
import importlib

parser = argparse.ArgumentParser(description='Process some integers.')
parser.add_argument('--db', type=str, default='colav',
                    help='database name (default colav)')
parser.add_argument('--db_ip', type=str, default='localhost',
                    help='mongodb ip (default localhost)')
parser.add_argument('--db_port', type=int, default=27017,
                    help='mongodb port (default 27017)')
parser.add_argument(
    '--ip',
    type=str,
    default=None,
    help='local server ip (optional for public ip)')
parser.add_argument('--port', type=int, default=8080,
                    help='server port (default 8080)')
parser.add_argument('--apikey', type=str, default='colavudea', help='apikey')
parser.add_argument('--config', type=str, required=True,
                    help='python file with a dictionary called config, take a look in the README for more information.')

args = parser.parse_args()
if args.ip is None:
    ip = socket.gethostbyname(socket.gethostname())
else:
    ip = args.ip

config_file = args.config
loader = importlib.machinery.SourceFileLoader('config', config_file)
spec = importlib.util.spec_from_loader(loader.name, loader)
config = importlib.util.module_from_spec(spec)
loader.exec_module(config)
config = config.config


if __name__ == '__main__':
    server = Hunabku(config)
    server.start()
